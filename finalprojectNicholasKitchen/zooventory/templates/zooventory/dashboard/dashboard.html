{% extends 'zooventory/base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="container py-5">

    <div class="text-center mb-4">
        <h1>Your Dashboard</h1>
        <p class="text-muted">Your feeding activity, food usage, and animal stats at a glance.</p>
    </div>

    <!-- CHART ROW 1 -->
    <div class="row g-4 mb-4">

        <!-- Chart 1 -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-light fw-bold">
                    Food Usage Over Time - Last 30 Days
                </div>
                <div class="card-body">
                    <canvas id="foodUsageChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Chart 2 -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-light fw-bold">
                    Feeding Frequency by Animal - Last 30 Days
                </div>
                <div class="card-body">
                    <canvas id="feedingFrequencyChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <!-- CHART ROW 2 -->
    <div class="row g-4 mb-4">

        <!-- Chart 3 -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning fw-bold">
                    Top Food Consumption - Last 30 Days
                </div>
                <div class="card-body">
                    <canvas id="topFoodChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Chart 4 -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-light fw-bold">
                    Animal Weight Trends - Last 30 Days
                </div>
                <div class="card-body">
                    <canvas id="weightTrendChart"></canvas>
                </div>
            </div>
        </div>

    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Food Usage Chart
    (async function() {
        const response = await fetch('{% url 'chart_food_usage' %}');
        const json = await response.json();

        new Chart(document.getElementById('foodUsageChart'), {
            type: 'line',
            data: {
                labels: json.labels,
                datasets: [
                    {
                        label: 'Grams Used',
                        data: json.grams,
                        borderWidth:2,
                        borderColor: 'green',
                        backgroundColor: 'rgba(0, 128, 0, 0.2)',
                        tension: 0.3
                    },
                    {
                        label: 'Milliliters Used',
                        data: json.ml,
                        borderWidth:2,
                        borderColor: 'blue',
                        backgroundColor: 'rgba(0, 0, 255, 0.2)',
                        tension: 0.3
                    }
                ]
            },
            options: {
                spanGaps: true,
                scales: {
                    x: {
                        ticks: {
                            callback: function(value, index) {
                                return this.getLabelForValue(value).slice(5);
                            }
                        }
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            }
        })
    })();

    // Feeding Frequency Chart
    (async function() {
        const response = await fetch('{% url 'chart_feeding_frequency' %}');
        const json = await response.json();

        new Chart(document.getElementById('feedingFrequencyChart'), {
            type: 'bar',
            data: {
                labels: json.labels,
                datasets: [
                    {
                        label: 'Feedings',
                        data: json.total,
                        borderWidth:2,
                        borderColor: 'rgba(0, 123, 255, 1)',
                        backgroundColor: 'rgba(0, 123, 255, 0.3)',
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        ticks: {
                            autoSkip: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        })
    })();
</script>

{% endblock %}

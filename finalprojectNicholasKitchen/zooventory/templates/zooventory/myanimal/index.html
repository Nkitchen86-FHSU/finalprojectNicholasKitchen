{% extends 'zooventory/base.html' %}

{% block title %}My Animals{% endblock %}

{% block content %}
<div class="container my-5">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-dark fw-bold">My Animals</h1>
        <a href="{% url 'myanimal_create' %}" class="btn btn-primary">+ Add New Animal</a>
    </div>


    <!-- FILTER / SORT / SEARCH BAR -->
    <form method="GET" class="card p-3 mb-4 shadow-sm" style="background-color: #f5f5dc;">
        <div class="row g-3">

            <!-- SEARCH -->
            <div class="col-md-4">
                <label class="fw-bold">Search by Name</label>
                <input type="text" name="search" class="form-control"
                       placeholder="Search..."
                       value="{{ search }}">
            </div>

            <!-- SPECIES FILTER -->
            <div class="col-md-3">
                <label class="fw-bold">Filter by Species</label>
                <select name="species" class="form-select">
                    <option value="all">All Species</option>
                    {% for s in species_list %}
                        <option value="{{ s }}" {% if s == species %}selected{% endif %}>
                            {{ s }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- AGE FILTER -->
            <div class="col-md-3">
                <label class="fw-bold">Filter by Age</label>
                <select name="age_range" class="form-select">
                    <option value="">Any Age</option>
                    <option value="1-10" {% if age_range == "1-10" %}selected{% endif %}>1–10</option>
                    <option value="11-20" {% if age_range == "11-20" %}selected{% endif %}>11–20</option>
                    <option value="21-30" {% if age_range == "21-30" %}selected{% endif %}>21–30</option>
                    <option value="30+" {% if age_range == "30+" %}selected{% endif %}>30+</option>
                </select>
            </div>

            <!-- SORT -->
            <div class="col-md-2">
                <label class="fw-bold">Sort</label>
                <select name="sort" class="form-select">
                    <option value="name_asc" {% if sort == "name_asc" %}selected{% endif %}>Name A–Z</option>
                    <option value="name_desc" {% if sort == "name_desc" %}selected{% endif %}>Name Z–A</option>
                </select>
            </div>

        </div>

        <!-- SUBMIT BUTTON -->
        <div class="mt-3 text-end">
            <button class="btn btn-success">Apply Filters</button>
            <a href="{% url 'myanimal_index' %}" class="btn btn-secondary">Reset</a>
        </div>
    </form>


    <!-- ANIMAL LIST -->
    {% if myanimals %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for a in myanimals %}
                <div class="col">
                    <div class="card shadow-sm border-0 h-100">

                        <!-- HEADER -->
                        <div class="card-header text-light" style="background-color: #1e7e34;">
                            <h5 class="mb-0">{{ a.name }}</h5>
                        </div>

                        <!-- BODY -->
                        <div class="card-body" style="background-color: #f5f5dc;">
                            <p>
                                <strong>Species:</strong> {{ a.species }}
                                {% if a.unique_animal %}
                                    <a href="{% url 'uniqueanimal_info' a.unique_animal.id %}"
                                       class="ms-1 text-primary"
                                       title="More info about this species">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="#1e7e34" class="bi bi-question-circle" viewBox="0 0 16 16">
                                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                            <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134"/>
                                        </svg>
                                    </a>
                                {% endif %}
                            </p>

                            <p><strong>Age:</strong> {{ a.age }}</p>
                            <p><strong>Weight:</strong> {{ a.weight_lb }} lb {{ a.weight_oz }} oz</p>
                            <p><strong>Last Fed:</strong> {{ a.last_fed|default:"Never" }}</p>

                            <!-- ACTION BUTTONS -->
                            <div class="mt-3 d-flex flex-wrap gap-2">

                                <!-- Feeding Schedule -->
                                <a href="{% url 'feeding_schedule_index' a.id %}"
                                   class="btn btn-outline-primary btn-sm">
                                    Feeding Schedule
                                </a>

                                <!-- Edit -->
                                <a href="{% url 'myanimal_update' a.id %}"
                                   class="btn btn-outline-success btn-sm">
                                    Edit
                                </a>
                            </div>

                        </div>

                    </div>
                </div>
            {% endfor %}
        </div>

    {% else %}
        <p class="text-center text-muted mt-5">No animals found.</p>
    {% endif %}

</div>
{% endblock %}

